#!/usr/bin/env node

var idgen = require('idgen').hex
  , request = require('request')
  , base = 'https://gist.github.com/'
  , checked = 0
  , secrets = 0
  , concurrency = process.argv[2] ? Number(process.argv[2]) : 10

function next () {
  var u = base + idgen(20);
  request({uri: u}, function (err, resp, body) {
    if (err) {
      console.error(err);
    }
    else if (resp.statusCode === 404) {
      // ...
    }
    else if (resp.statusCode === 200) {
      console.log('secret!', u);
      secrets++;
    }
    else {
      console.log('???', resp.statusCode, u);
    }
    checked++;
    next();
  });
}

setInterval(function () {
  console.log(secrets + '/' + checked + ' secrets/attempts');
}, 5000);

for (var i = 0; i < concurrency; i++) next();
